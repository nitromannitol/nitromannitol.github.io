<!DOCTYPE html>
<meta charset="utf-8">


<!-- load the plotly.js and math.js libraries -->      

<head>
  <title> Kuwait COVID-19 Forecasts </title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53592269-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53592269-3');
</script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://unpkg.com/mathjs@6.6.1/dist/math.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>



<style> /* set the CSS */
body { 
  margin-left: 20px;
}
</style>


</head>




<body>



<div class="plot" id="plotdiv">

</div>

<div> 
<form id="form1">
   <select class="countrydata" id = "countrydata_" multiple="multiple">
        <option value="Ensemble">Ensemble</option>
    <option value="Imperial">Imperial</option>
        <option value="LANL">LANL</option>
                <option value="MIT">MIT</option>
                <option value="UCLA">UCLA</option>
                <option value="Geneva">Geneva</option>
                <option value="YYG">YYG</option>
    </select>
    <input type="button" id="btnget1" value="Plot selected forecasts" />
</form>
</div>





<script>

var min_cases_count = 50; 
var min_length = 10; 
var num_nearest = 3; 


$(function() {
      $('#countrydata_').multiselect({
        includeSelectAllOption: true,
        enableCaseInsensitiveFiltering: true,
      });

      $('#btnget1').click(function(){

        //console.log($('#countrydata_').val())
       // alert($('#countrydata_').val());
        makeplot($('#countrydata_').val())
      });
      $('#btnget2').click(function(){
        findNearest($('#countrydata_').val())
        //console.log($('#countrydata_').val())
       // alert($('#countrydata_').val());
      });
  });



function unique ( array ) {
    return array.filter(function(a){
        return !this[a] ? this[a] = true : false;
    }, {});
}


function findNearest(countries) {
 Plotly.d3.csv('https://covid.ourworldindata.org/data/ecdc/total_cases_per_million.csv', function(data){ processFindNearest(data, countries)});
};


function makeplot(countries = ["Kuwait"], verticalLines = []) {
  //Plotly.d3.csv("total_cases_per_million.csv", function(data){ processData(data, countries) } );
  Plotly.d3.csv('https://covid.ourworldindata.org/data/ecdc/total_cases_per_million.csv', function(data){ processData(data, countries, verticalLines) });
};

//https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/ecdc/total_cases_per_million.csv

function findNearestCountry(allRows, country){
  var total_count = [];
  var locations = d3.keys(allRows[0])
  locations = locations.slice(1,locations.length+1);
  unique_locations = unique(locations);
  // first determine vector of normalized 20 counts per million 
  var country_norm_vec = []; 
  for(var j = 0; j < allRows.length; j++){
      var norm_count = allRows[j][country]; 
      if(norm_count >= min_cases_count){
        country_norm_vec.push(norm_count);
      }
    };
  x0 = country_norm_vec.length;
  y1 = math.max(country_norm_vec);

   // console.log(country_norm_vec)


  // now determine all countries closest to it
  var country_names = []; 
  var msd_val = []; 
  var max_vec = []; 

  for(var i = 0; i < unique_locations.length; i++){
    //fill out the array corresponding to the normalized count of country
    //starting at first day
    var y = []; 
    for(var j = 0; j < allRows.length; j++){
      var norm_count = allRows[j][unique_locations[i]]; 
      if(norm_count >= min_cases_count){
        y.push(norm_count);
      }
    }; 
    if(y.length < min_length || y.length < country_norm_vec.length){
      continue; 
    }
    y = y.slice(0, country_norm_vec.length)

   // console.log(math.subtract(y, country_norm_vec))
    msd_val.push(math.norm(math.subtract(y,country_norm_vec)))
    country_names.push(unique_locations[i])
    max_vec.push(math.max(y));
  };

  //console.log(msd_val)


  var indices = new Array(msd_val.length);
  for (var i = 0; i < msd_val.length; ++i) indices[i] = i;
  indices = indices.sort(function (a, b) { return msd_val[a] < msd_val[b] ? -1 : msd_val[a] > msd_val[b] ? 1 : 0; });
  //console.log(indices)

  var nearest_countries = []
  for(var i = 0; i < num_nearest; i++){
    nearest_countries.push(country_names[indices[i]]);
    y1 = math.max(y1, max_vec[indices[i]]);
  }

  return [nearest_countries,x0,y1];

}



function processFindNearest(allRows, countries){
  //console.log("hello")
  var nearest_countries = []; 
 // console.log(countries)
  verticalLines = []; 
   for(var i=0; i < countries.length;i++){
    country = countries[i]; 
    out_vec = findNearestCountry(allRows,country);
    verticalLines.push([out_vec[1], out_vec[2]]);
    nearest_countries.push(out_vec[0]);
  }

  console.log(verticalLines)
  //console.log(nearest_countries.flat());
  makeplot(nearest_countries.flat(), verticalLines);
}

  
function processData(allRows, countries, verticalLines) {
  var dates = [];
  var total_count = [];
  var locations = d3.keys(allRows[0])
  date_name = locations[0] 
  locations = locations.slice(1,locations.length+1);

  //console.log(allRows[0].Kuwait)

  for (var i=0; i<allRows.length; i++) {
    row = allRows[i];
    dates.push( row[date_name] );
  }
  //console.log(allRows[])
  makePlotly( dates,allRows, locations, countries,verticalLines);
}



function makePlotly( dates, allRows, locations, countries,verticalLines){
  var plotDiv = document.getElementById("plotdiv");




  // each frame will be associated to a country
  // exponential model fit  
  // total cases per million up to that point in time 
  var frames = [];
  unique_locations = unique(locations);
  //console.log(unique_locations)
  for(var i = 0; i < unique_locations.length; i++){
    //fill out the array corresponding to the normalized count of country
    //starting at first day
    var y = []; 
    //y.push(0);
    for(var j = 0; j < dates.length; j++){
      var norm_count = allRows[j][unique_locations[i]]; 
      if(norm_count >= min_cases_count){
        y.push(norm_count);
      }
    };
    if(y.length < min_length){
      continue; 
    }

    //this doesn't work at the moment so need to do by hand 
    // selector = document.querySelector('.countrydata');
    // textArray = unique_locations[i]; 
    // var currentOption = document.createElement('option');
    // currentOption.text = textArray;
    // currentOption.value = textArray;
    // selector.appendChild(currentOption);
    // console.log(currentOption)
    // console.log(selector)

    var x =[...Array(y.length).keys()];
    x = math.add(x,1)
    var curr_frame =  {data: [{x: [], y: []}], name: unique_locations[i]};

    curr_frame.data[0].x = x;
    curr_frame.data[0].y = y; 

    frames.push(curr_frame);

  };



  data = []; 
  // build dataset using countries
  for(var i = 0; i < countries.length; i++){
    curr_country = countries[i]; 
    for(var j = 0; j < frames.length; j++){
      //console.log(j, frames[j].name)
        if(frames[j].name==curr_country){
             var trace1 = {
                x: frames[j].data[0].x, 
                y: frames[j].data[0].y,
                name: frames[j].name,
                mode: 'lines+markers',
                type: 'scatter'
            };
            data.push(trace1);
          }
        }
  }


  var layout = {
    title: {
      text:'COVID-19 National Forecasts',
      font: {
        family: 'Arial',
        size: 24
      },
      xref: 'paper',
    },

     legend: {
      //orientation: 'd',
      y: 0.5,
      yref: 'paper',
      font: {
        family: 'Arial',
        size: 15
      },
    bgcolor: '#E2E2E2',
    bordercolor: '#FFFFFF',
    borderwidth: 2
    },

    xaxis: {
    title: {
      text: 'days',
      font: {
        family: 'Arial',
        size: 18,
        color: '#7f7f7f'
      }
    },
  },
  yaxis: {
    title: {
      text: 'confirmed deaths',
      font: {
        family: 'Arial',
        size: 18,
        color: '#7f7f7f'
      }
    }
  }, 
  shapes: [
  ]
};

  
  console.log(verticalLines.length)

  for(var i = 0; i <verticalLines.length;i++){
    row = verticalLines[i]; 
    val1 = row[0]; 
    val2 = row[1]; 

    val =  { type: 'line',
      x0: val1,
      y0: 0,
      x1: val1,
      y1: val2,
      line: {
        color: 'rgb(1, 1, 1)',
        width: 2,
        dash: 'dashdot'
      }
    };

    layout.shapes.push(val)

  }






    


  //console.log(layout.shapes[0].x0)
  //layout.shapes[0].x0 = 40; 
  //layout.shapes[0].x1 = 40; 

  //layout.shapes.y1 = 40; 




  



   


   

   Plotly.newPlot(plotDiv, data, layout)

};


// Default with closest countries to Kuwait
//makeplot(["Kuwait", "Bahrain", "United Arab Emirates", "Saudi Arabia", "Qatar", "Oman"]); 
//makeplot(["Kuwait", "Bahrain", "Oman"]); 
findNearest(["Kuwait"])

//selector = document.querySelector('.countrydata');
//console.log(selector)


</script>
</body>



<hr>
Select the forecast model from the dropdown bar and click the first button to plot the forecast. Models
make various assumptions about levels of social distancing and other interventions. See model descriptions
below for details. 


<hr>


<h2><a id="what-forecasts-predict" class="onThisPageAnchor" title="What the Forecasts Aim to Predict"></a>What the Forecasts Aim to Predict</h2>

<p>Forecasts based on statistical or mathematical models aim to predict changes in national level cumulative reported COVID-19 deaths for the next four weeks. Forecasting teams predict numbers of deaths using different types of data (e.g., COVID-19 data, demographic data, mobility data), methods (see below), and estimates of the impacts of interventions (e.g.&nbsp;social distancing, use of face coverings).</p>
<h2><a id="working" class="onThisPageAnchor" title="Working to Bring Together Forecasts for COVID-19 Deaths in the US"></a>Working to Bring Together Forecasts for COVID-19 Deaths in the US</h2>
<p> These forecasts have been developed independently and shared publicly. It is important to bring these forecasts together to help understand how they compare with each other and how much uncertainty there is about what may happen in the upcoming four weeks.</p>



<h3><a href="https://covid19-infection-model.auquan.com/" class="tp-link-policy" data-domain-ext="com">Auquan Data Science<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name:</strong> Auquan</p>
<p><strong>Intervention assumptions:</strong> These projections do not make specific assumptions about which interventions have been implemented or will remain in place.</p>
<p><strong>Methods:</strong> Fitted SEIR model</p>




<h3><a id="imperial-college-london"></a><a href="https://mrc-ide.github.io/covid19-short-term-forecasts/index.html" class="tp-link-policy" data-domain-ext="io">Imperial College, London<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name:</strong> Imperial</p>
<p><strong>Intervention Assumptions: </strong>These projections do not make specific assumptions about which interventions have been implemented or will remain in place.</p>
<p><strong>Methods:</strong> Ensembles of mechanistic transmission models, fit to different parameter assumptions.</p>






<h3><a id="los-alamos-lab"></a><a href="https://covid-19.bsvgateway.org/" class="tp-link-policy" data-domain-ext="org">Los Alamos National Laboratory<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name:</strong> LANL</p>
<p><strong>Intervention assumptions: </strong>This model assumes that currently implemented interventions and corresponding reductions in transmission will continue, resulting in an overall decrease in the growth rate of COVID-19. Over the course of the forecast, the model assumes that the rate of growth will decrease over time.</p>
<p><strong>Methods</strong><br>
Statistical dynamical growth model accounting for population susceptibility</p>


<h3><a id="mit"></a><a href="https://www.covidanalytics.io/projections" class="tp-link-policy" data-domain-ext="io">Massachusetts Institute of Technology<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name: </strong>MIT</p>
<p><strong>Intervention Assumptions:</strong> The projections assume that current interventions will remain in place indefinitely.</p>
<p><strong>Methods: </strong>SEIR model fit to reported death and case counts.</p>




<h3><a id="ucla"></a><a href="https://covid19.uclaml.org/" class="tp-link-policy" data-domain-ext="org">University of California, Los Angeles<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name:</strong> UCLA</p>
<p><strong>Intervention assumptions:</strong> These projections assume that current interventions will not change during the forecasted period.</p>
<p><strong>Methods:</strong> Modified SEIR model</p>



<h3><a id="geneva"></a><a href="https://renkulab.shinyapps.io/COVID-19-Epidemic-Forecasting/" class="tp-link-policy" data-domain-ext="io">University of Geneva / Swiss Data Science Center<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name:</strong> Geneva</p>
<p><strong>Intervention assumptions: </strong>The projections assume that social distancing policies in place at the date of calibration are extended for the future weeks.</p>
<p><strong>Methods</strong><br>
Exponential and linear statistical models fit to the recent growth rate of cumulative deaths.</p>


<h3><a href="http://covid19-projections.com/about/" class="tp-link-policy" data-domain-ext="com">Youyang Gu (COVID-Projections)<span class="sr-only">external icon</span><span class="fi cdc-icon-external x16 fill-external" aria-hidden="true"></span></a></h3>
<p><strong>Model name:</strong> YYG</p>
<p><strong>Intervention assumptions:</strong> The model accounts for individual state-by-state re-openings and their impact on infections and deaths.</p>
<p><strong>Methods</strong><br>
SEIS mechanistic model.</p>
</div></div><div class="row "><div class="col-md-12"><div class="row-fluid">
  <div class="vc_empty_space col-12 pb-3"><span class="vc_empty_space_inner"></span></div>
</div>
</div></div></div>









